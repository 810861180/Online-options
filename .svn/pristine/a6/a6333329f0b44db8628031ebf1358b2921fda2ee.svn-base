<template>
  <div>
    <el-card class="box-card">
      <div class="title">
        <p>活动信息</p>
        <div></div>
      </div>
      <div class="content">
        <el-form :model="form" :rules="rules" ref="ruleForm" label-width="80px">
          <el-form-item label="会议主题" prop="name">
            <el-input v-model="form.name"></el-input>
          </el-form-item>
          <el-form-item label="会议时间" prop="date1" style="display: inline-block;width: 49%;">
            <el-date-picker type="datetime" v-model="form.date1" style="width: 100%;"></el-date-picker>
          </el-form-item>
          <el-form-item label="结束时间" prop="date2" style="display: inline-block;width: 50.7%;">
            <el-date-picker type="datetime" v-model="form.date2" style="width: 100%;"></el-date-picker>
          </el-form-item>
          <el-form-item label="会议地点" prop="city">
            <el-col :span="8">
              <el-cascader :options="options" :props="props" v-model="form.city" @active-item-change="handleItemChange" style="width:95%;">
              </el-cascader>
            </el-col>
            <el-col :span="16">
              <el-input v-model="form.detail" placeholder="详细地址"></el-input>
            </el-col>
          </el-form-item>
          <el-form-item label="主办单位" prop="sponsor">
            <el-input v-model="form.sponsor"></el-input>
          </el-form-item>
          <el-form-item label="会议背景" prop="imgSrc">
            <div class="hybackground">
              <img :src="form.imgSrc" border="0" alt="">
            </div>
            <div class="hint">
              <p class="p1">注意事项：</p>
              <p class="p2">建议上传尺寸 1920px*1080px 的.png、<br/>.jpg、.gif图片，图片小于1M</p>
              <upload @uploads='uploads' ref="activityUpload"></upload>
            </div>
          </el-form-item>
          <el-form-item label="活动详情" prop="particulars">
            <!-- <tinymce></tinymce> -->
            <el-input type="textarea" :rows="7" placeholder="请输入内容" v-model="form.particulars"></el-input>
          </el-form-item>
          <el-col :span="12">
            <el-form-item label="手机号码">
              <el-input v-model="form.phone"></el-input>
            </el-form-item>
          </el-col>
          <el-col :span="12">
            <el-form-item label="参会人数">
              <el-input v-model="form.number"></el-input>
            </el-form-item>
          </el-col>
        </el-form>
      </div>

    </el-card>
    <div class="footer">
      <el-button type="primary" class="btn" @click="submitForm">保存活动信息</el-button>
    </div>
  </div>
</template>

<script>
import tinymce from '@/components/editor/tinymce'
import upload from '@/components/imgUpload/upload'
export default {
  components: {
    tinymce,
    upload
  },
  data () {
    return {
      options: [],
      props: {
        value: 'value',
        children: 'cities'
      },
      form: {
        name: '', //会议主题
        date1: '',  //开始时间
        date2: '',  //结束时间
        city: [],   //会议地点
        detail: '', //会议地点详细地址
        sponsor: '',  //主办单位
        imgSrc: '', //背景图地址
        particulars: '', //活动详情
        phone: '',
        number: '' // 参会人数
      },
      rules: {
        name: [
          { required: true, message: '请输入会议主题', trigger: 'blur' },
        ],
        date1: [
          { required: true, message: '请输入开始时间', trigger: 'blur' },
        ],
        date2: [
          { required: true, message: '请输入结束时间', trigger: 'blur' },
        ],
        city: [
          { required: true, message: '请输入会议地点', trigger: 'blur' },
        ],
        sponsor: [
          { required: true, message: '请输入主板单位', trigger: 'blur' },
        ],
        imgSrc: [
          { required: true, message: '请上传会议背景', trigger: 'blur' },
        ],
        particulars: [
          { required: true, message: '请输入活动详情', trigger: 'blur' },
        ]

      }
    }
  },
  mounted () {
    this.$refs.activityUpload.classif('p3')
    this.$queryProvince().then(data => {
      if (data.data.result.flag) {
        this.options = this.disposeArr(data.data.result.data)
      }
    })
  },
  methods: {
    //表单提交
    submitForm () {
      console.log(this.form)
      this.$refs['ruleForm'].validate((valid) => {
        if (valid) {
          alert('submit!')
        } else {
          console.log('error submit!!')
          return false
        }
      })
    },
    // 子组件传递参数
    uploads(val) {
        // console.log('uploads', val)
        this.form.imgSrc = val
    },
    // 地址连级下拉框
    handleItemChange (val) {
      setTimeout(() => {
        if (val.length === 1) {
          this.$querycity(val[0]).then(data => {
            this.options.map(item => {
              if (item.value == val[0]) {
                item.cities = this.disposeArr(data.data.result.data)
              }
            })
          })
        } else {
          this.$querycounty(val[1]).then(data => {
            this.options.map(item => {
              if (item.value == val[0]) {
                item.cities.map(item => {
                  item.cities = this.disposeArr(data.data.result.data, true)
                })
              }
            })
          })
        }
      }, 300)
    },
    // 地址数组处理
    disposeArr (arr, flag) {
      let test = []
      arr.forEach((item, index) => {
        test.push({})
        test[index]['label'] = item.regionNAME
        test[index]['value'] = item.regionCode
        if (!flag) test[index]['cities'] = []
      })
      return test
    }
  }
}
</script>

<style lang="scss" scoped>
.box-card {
  width: 100%;
  .title {
    width: 100%;

    p {
      font-size: 18px;
      font-family: Adobe Heiti Std R;
      font-weight: bold;
      color: rgba(59, 73, 102, 1);
      margin: 0 0 0 2.5%;
    }
    div {
      width: 98%;
      height: 2px;
      margin: 0 auto;
      margin-top: 10px;
      background: rgba(87, 159, 233, 1);
    }
  }
  .content {
    width: 95%;
    margin: 0 auto;
    padding: 30px 0 0 0;
    margin-bottom: 150px;
  }
}

.hybackground {
  height: 270px;
  width: 480px;
  border: 1px solid #dcdfe6;
  display: inline-block;
  vertical-align: top; 
  img{
    width: 100%;
    height: 100%;
  } 
}
.hint {
  display: inline-block;
  margin-left: 100px;

  .p1 {
    color: #579fe9;
    font-size: 18px;
    margin-top: 30px;
  }
  .p2 {
    font-size: 12px;
    line-height: 14px;
    margin-top: 10px;
  }
  .p3 {
    width: 200px;
    height: 34px;
    border-radius: 5px;
    font-size: 12px;
    margin-top: 50px;
  }
}

.footer {
  width: 100%;
  height: 70px;
  position: fixed;
  bottom: 0;
  right: 0;
  z-index: 999;
  background: #434343;
  padding: 0 50px;
  .btn {
    height: 40px;
    line-height: 20px;
    width: 200px;
    border-radius: 2px;
    margin-top: 15px;
    float: right;
  }
}
</style>
